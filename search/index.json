[{"content":"üöÄ Motivation Waymo is rapidly expanding across the United States, rolling out autonomous ride-hailing services in city after city. The ambitions are bold ‚Äî but what does it take to realistically meet urban demand with autonomous vehicles?\nThis blog post explores how ride-hailing simulations with MATSim DRT Contrib can help cities, mobility strategists, and tech companies estimate the fleet size required to serve real-world demand. By simulating autonomous deployments, we gain actionable insights into what a Waymo-like service would need to operate effectively in a new urban environment.\nOne city stands out: Chicago. The City of Chicago provides a highly detailed, continuously updated ride-hailing dataset ‚Äî a true hidden gem that‚Äôs often overlooked in both academic and commercial circles. It offers a rare opportunity to analyze real booking behavior at scale.\nIn this post, I‚Äôll show you how to unlock the full potential of this dataset using Java, Python, MATSim, and Simunto software. We‚Äôll dive deep into the data and explore how simulation can turn raw demand into strategic deployment decisions.\nüì¶ Input Data: Real Ride-Hailing Trips from Chicago The foundation of this analysis is a public dataset provided by the City of Chicago, titled Transportation Network Providers - Trips (2025). It contains anonymized trip-level data from ride-hailing services like Uber and Lyft, and is published under Public Domain ‚Äî making it freely usable for both academic and commercial purposes.\nYou can access the data in two ways:\nCSV Archive Download: A full-year dump, currently around 12.5 GB of raw data for 2025. API Access: Ideal for downloading specific days or weeks without handling the full dataset. You can get a full overview of the provided attributes per trip check out this source. The so call PlansConverter allows you to download and cache files day by day. Moreover, trip demand gets transformed to MATSim compatible input.\n‚ö†Ô∏è Working on 12.5 GB csv can be a significant hurdle. That‚Äôs why I‚Äôve created a PlansConverter that lets you fetch data for selected days or entire weeks with ease. You need to register in order to obtain an API token for my downloader.\nüìç Scope of Analysis: Intra-Chicago Trips Only It‚Äôs important to note that pickup and dropoff coordinates are omitted whenever a trip starts or ends outside the official boundaries of the City of Chicago. In such cases, fields like census tract, community area, and geolocation are left blank.\nAs a result, this analysis focuses exclusively on trips that both start and end within Chicago city limits. This ensures that all trips included in the simulation have valid spatial references and can be accurately mapped and analyzed. Origin and destination coordinates are represented by the census tract centroid. I created a census tract coordinate sampler that draws random start and end coordinates within each tract area.\nBy restricting the dataset to intra-city trips, we can:\nReliably reconstruct origin-destination flows Analyze demand patterns across community areas Simulate realistic operations within a well-defined urban service area This scope also mirrors how autonomous ride-hailing services like Waymo typically operate ‚Äî starting with clearly bounded service zones before expanding to broader regions.\nüìä A Typical Week of Ride-Hailing in Chicago Before diving into the simulation study, let\u0026rsquo;s take a moment to explore the data. For this, I downloaded a typical week of ride-hailing activity in Chicago via API access, covering the period from June 2 to June 8 2025.\nThis week includes a total of 888,610 trips.\nüó∫Ô∏è Spatial Distribution The spatial distribution of trips is shown in the image below:\nAs expected, demand hotspots include the downtown area and especially the airports, which show consistently high ride volumes.\nüìê Trip Distance Behavior To better understand how far people travel, I visualized the distribution of trip distances:\nAs someone who prefers walking as little as possible, I was surprised ‚Äî or maybe not ‚Äî to see that the American stereotype holds true: even the shortest distances, often less than 2 km, are frequently covered by ride-hailing services.\nThat said, it\u0026rsquo;s worth considering that nighttime safety concerns may also play a role in this behavior, encouraging people to opt for a ride rather than walking through the city.\nüí∏ Tip Behavior Insights Beyond trip volumes and distances, the dataset also offers valuable insights into tipping behavior ‚Äî something that‚Äôs often overlooked in ride-hailing analyses. Since Waymo vehicles don‚Äôt receive tips, understanding where human drivers earn the most in gratuities can reveal potential pricing opportunities for autonomous fleets.\nI visualized the spatial distribution of tip share, i.e., the proportion of the total fare that comes from tips. The results are intriguing:\nAirports stand out as areas where passengers tend to be more generous. Downtown and the northern parts of the city also show elevated tip shares. This could imply that in these regions, Waymo might need to adjust pricing to compensate for the lack of tips ‚Äî especially if competing with human drivers.\nüí¨ If you‚Äôre familiar with Chicago‚Äôs neighborhoods and have a hypothesis about these patterns, feel free to share your thoughts with me on LinkedIn!\nüìè Tip vs. Trip Distance After this spatial analysis, I was hooked and eager to see what else the data might reveal. Another interesting finding: shorter trips tend to have proportionally higher tips than longer ones.\nüîÑ API Download Experience One practical note: downloading this data via API was noticeably faster on weekends. During weekdays, the endpoint was heavily loaded and slow ‚Äî something to keep in mind if you\u0026rsquo;re planning to automate data access.\nüß™ Simulation Study: Building a MATSim Scenario from Real Ride-Hailing Data Now comes the fun part ‚Äî turning raw data into a working simulation. To do this, I‚Äôve developed a modular pipeline using three key Java classes that together build a complete MATSim scenario from the Chicago TNP dataset.\n‚ö†Ô∏è Disclaimer: A Simplified Simulation Perspective This simulation study is a simplified exploration of autonomous fleet deployment using MATSim and real-world ride-hailing data. While it provides valuable insights into demand patterns and operational feasibility, it does not yet include several advanced modeling components that are essential for commercial-grade applications.\nMATSim is capable of simulating much more complex systems, including:\nOperational Facilities: Hubs with charging infrastructure and parking space limitations Electric Vehicles (EVs): Including battery consumption models and charging behavior Service Tasks: Cleaning and maintenance Congestion Replication: Integrating congestion pattern from HERE or TomTom These elements significantly increase the complexity of the model and are crucial when building simulations for real-world deployment, investment decisions, or regulatory planning.\nüí¨ I‚Äôd love to hear your thoughts! Feel free to comment on this post or reach out via LinkedIn ‚Äî let me know what you\u0026rsquo;d like to see covered in the next edition of this series.\nüß± Building the Urban Road Network (NetworkConverter) This class downloads and processes an OpenStreetMap PBF file for the Chicago region. It clips the network to a bounding box, transforms coordinates to a local EPSG system, simplifies the network, and prepares it for DRT simulation by adding the necessary transport modes.\nUses SupersonicOsmNetworkReader for fast parsing Applies NetworkSimplifier to reduce complexity Adds drt mode to all car-accessible links Outputs a clean MATSim network file (network.xml.gz) üë• Generating Agent Plans from Real Trips (PlansConverter) This class connects to the City of Chicago‚Äôs TNP API, downloads trip data for a given date range, and converts each trip into a MATSim agent plan.\nEach trip becomes a Person with a Plan (home ‚Üí drt leg ‚Üí work) Includes attributes like fare, tip, trip_total, and shared_trip_match Supports sampling and census tract-based coordinate generation Outputs plans.xml.gz and a CSV summary of all trips üß© Orchestrating the Full Scenario (ScenarioCreator) This is the master class that ties everything together. It sets up directories, calls the network and plans converters, and generates a full MATSim config.xml with all necessary modules.\nConfigures DRT with advanced settings (e.g. parallel insertion, rebalancing, constraints) Generates a synthetic fleet (fleet.xml.gz) based on network topology Sets simulation time, scoring parameters, and zone systems Outputs a ready-to-run MATSim scenario with real-world demand With this setup, you can simulate how an autonomous fleet like Waymo might perform in Chicago ‚Äî using actual demand data, realistic routing, and configurable fleet behavior. Want to try it yourself? Try out the full code - If you need help. Feel free to reach out.\nüìà Results: How Many Vehicles Would Waymo Need? Almost like the cliffhanger in your favorite series ‚Äî you‚Äôve waited and wondered: How many vehicles would it take to serve all ride-hailing demand in Chicago with an autonomous fleet?\nBy gradually increasing the fleet size in simulation, we can estimate the number of vehicles required to keep the rejection rate (i.e., unserved trip requests) around 10%. The following plot shows that approximately 3500 vehicles are needed to meet this threshold during peak demand But that‚Äôs not the whole story. The utilization of the fleet is highly uneven across the week. Friday and Saturday evenings represent clear demand peaks, while the rest of the week shows significantly lower usage:\nThis utilization risk poses a serious economic challenge for autonomous operators like Waymo, Uber, or Lyft. Previously, this risk was absorbed by human drivers ‚Äî now it shifts to the companies themselves.\nIt‚Äôs likely that these providers will aim for a hybrid operational model, where an autonomous fleet handles baseline demand and the human driven fleet is request only during high-utilization periods. This would help mitigate the risk of underused assets and ensure a more sustainable business case.\nüîã Battery Sizing \u0026amp; Daily Mileage: A Classic Question One of the most frequently asked technical questions in autonomous fleet planning is:\nHow far does a vehicle need to drive per day?\nTo answer this, I ran a simple analysis based on the simulated weekly demand.\nThe simulation revealed a mileage of 350 km per day. Such a workload has direct implications for:\nBattery sizing Charging infrastructure Fleet rotation and maintenance cycles Especially for electric vehicles (EVs), this level of daily mileage requires robust energy management and operational planning.\nBut it doesn‚Äôt stop at batteries:\nüîß Other wear components such as tires, brakes, and suspension systems must also be dimensioned appropriately. High daily mileage leads to increased wear, and frequent repairs can quickly result in:\nHigher operational costs Increased fleet size requirements (to compensate for downtime) Reduced economic viability üí¨ What do you think? Share your thoughts or hypotheses on LinkedIn ‚Äî I‚Äôd love to hear what you\u0026rsquo;d explore in the next edition!\nStay tuned for the next iteration Author: Steffen Axer\n","date":"2025-08-24T00:00:00Z","image":"https://iteratively.io/p/drt-chicago/cover_hu_cd54db00a179a998.jpg","permalink":"https://iteratively.io/p/drt-chicago/","title":"How Many Cars Would Waymo Need in Chicago?"},{"content":"üí° Motivation During the development of DSim (Distributed MATSim) ‚Äî as presented at MUM 2025 ‚Äî it became evident that Demand Responsive Transport (DRT) systems pose a significant bottleneck in large-scale MATSim simulations. Especially when simulating thousands of autonomous rides, the insertion logic for unplanned requests becomes computationally expensive and limits overall scalability.\nThis is problematic because fast and scalable DRT simulations are crucial for system planning in Autonomous Driving Mobility-as-a-Service (AD MaaS). As fleets and demand grow, cities and operators need to regularly optimize service configurations. This requires simulation frameworks that can handle high request volumes efficiently.\nTo address this, I developed the ParallelUnplannedRequestInserter, a multi-threaded insertion engine designed to scale with demand and fleet size.\n‚öôÔ∏è Conceptual Design The ParallelUnplannedRequestInserter is a parallelized implementation of MATSim‚Äôs UnplannedRequestInserter interface. It introduces the following key concepts:\nPartitioning: Incoming DRT requests and available vehicle entries are partitioned using RequestsPartitioner and VehicleEntryPartitioner. Worker Threads: Each partition is processed by a dedicated RequestInsertWorker, which performs insertion logic independently. Conflict Resolution: After parallel processing, insertions are consolidated. Conflicts (e.g., multiple requests assigned to the same vehicle) are resolved iteratively. Thread Activity Logging: Optionally logs request density and active partitions over time for performance diagnostics. This design enables concurrent evaluation of insertion possibilities, significantly reducing simulation time for high-volume DRT scenarios.\nüß© Partitioning Strategies Explained This simulation uses two interfaced partitioning strategies to improve scalability and responsiveness in high-load DRT scenarios:\nüì• Request-Partitioner This partitioner (LoadAwareRoundRobinRequestsPartitioner) distributes incoming DRT requests across multiple partitions using a load-aware round-robin strategy. Unlike a static round-robin, it dynamically adjusts the number of active partitions based on the current request load and a configurable scaling function.\nFor every additional 20 requests per minute, one additional partition is activated. Requests are assigned cyclically to active partitions using an internal counter. This ensures efficient use of resources and better parallelization under varying demand levels. Importantly, under low demand, the partitioner avoids unnecessary fragmentation of requests. This helps maintain simulation quality by reducing empty trips and rejection rates, which would otherwise increase due to overly distributed demand. üöó Vehicle-Partitioner This partitioner (ShiftingRoundRobinVehicleEntryPartitioner) assigns vehicles to request partitions using a shifting round-robin strategy:\nVehicles are distributed cyclically across active partitions. The starting index shifts with each invocation to avoid systematic bias. Only partitions with at least one request are considered. Vehicles are sorted deterministically by ID to ensure reproducibility. Together, these strategies ensure that both requests and vehicles are evenly and dynamically distributed across processing threads, improving simulation performance and fairness over time.\nüìä Benchmark Results The chart compares simulation durations for two partitioning strategies across different agent counts:\nBaseline (orange): shows a steep increase in simulation time as the number of agents grows. Optimized (blue): maintains significantly lower durations, scaling more efficiently. At 100,000 agents, the optimized setup is 1.60√ó faster than the baseline.\nAt 200,000 agents, the speedup increases to 2.60√ó.\nAn extrapolation suggests that at 400,000 agents, the optimized strategy could be 4.60√ó faster, highlighting its scalability advantage.\nThis benchmark demonstrates how intelligent partitioning can drastically reduce simulation time in large-scale DRT scenarios.\nüõ†Ô∏è How to Use To enable the ParallelUnplannedRequestInserter in your MATSim DRT simulation, follow these steps:\nAdd DrtParallelInserterParams to your DRT config:\n1 2 3 DrtParallelInserterParams params = new DrtParallelInserterParams(); params.setLogThreadActivity(true); // Optional: enables logging drtCfg.addParameterSet(params); Replace the default inserter module with the parallel version:\n1 controller.addOverridingQSimModule(new ParallelRequestInserterModule(drtCfg)); Choose your insertion strategy:\nFor Extensive Search: 1 2 drtCfg.removeParameterSet(drtCfg.getDrtInsertionSearchParams()); drtCfg.addParameterSet(new ExtensiveInsertionSearchParams()); For Repeated Selective Search: 1 2 drtCfg.removeParameterSet(drtCfg.getDrtInsertionSearchParams()); drtCfg.addParameterSet(new RepeatedSelectiveInsertionSearchParams()); Run your simulation as usual:\n1 2 Controler controller = DrtControlerCreator.createControler(config, false); controller.run(); üîß Configuration Parameters Parameter Description Default collectionPeriod Time window (in seconds) for collecting incoming requests before processing begins. Larger values increase batching but may delay responsiveness. 15.0 maxIterations Maximum number of conflict resolution iterations. Helps resolve cases where multiple partitions assign requests to the same vehicle. 2 maxPartitions Maximum number of partitions (i.e., parallel workers). Each partition processes a subset of requests and vehicles. 4 insertionSearchThreadsPerWorker Number of threads allocated per worker for performing insertion searches. 4 logThreadActivity Enables logging of thread activity and request density. Useful for diagnostics and benchmarking. false vehiclesPartitioner Strategy for partitioning vehicles across workers. Options: These parameters allow you to balance performance, parallelism, and conflict resolution quality depending on your scenario scale and hardware capabilities.\nFor a complete example, refer to the RunDrtExampleIT.java integration test, which demonstrates various configurations.\nüß† Conclusion The ParallelUnplannedRequestInserter is a powerful enhancement for MATSim‚Äôs DRT module, enabling scalable, high-performance simulations that are essential for future mobility planning. Whether you\u0026rsquo;re simulating autonomous fleets or optimizing MaaS strategies, this tool ensures that your simulations remain fast, reliable, and adaptable ‚Äî even at large scale.\nBy leveraging parallel processing and dynamic partitioning, it significantly improves the economic feasibility of large-scale studies. Simulations that previously required hours or days can now deliver actionable insights in a fraction of the time. This acceleration not only reduces computational costs but also shortens the time to decision-making ‚Äî a critical factor in agile urban planning and transport strategy development.\nA logical next step is to combine these optimizations with DSim (Distributed MATSim), enabling distributed execution across multiple machines or clusters. This will unlock even greater scalability, allowing researchers and planners to simulate entire regions or countries with high fidelity and responsiveness.\nStay tuned for the next iteration Author: Steffen Axer\n","date":"2025-08-07T00:00:00Z","image":"https://iteratively.io/p/drt-speedup/cover_hu_c1e810fc739b6497.jpg","permalink":"https://iteratively.io/p/drt-speedup/","title":"Fast \u0026 Curious: How to Speed Up DRT Simulations in MATSim"}]